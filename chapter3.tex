\chapter{ОПТИМАЛЬНОЕ УПРАВЛЕНИЕ ЛИНЕЙНОЙ СИСТЕМОЙ В ОТСУТСТВИЕ МОДЕЛИ СИСТЕМЫ}\label{chap3}
Ниже будет рассмотрена задача из предыдущей главы при условии отсутствия заранее известной реализации системы в пространстве состояний. Классический подход в подобных ситуациях состоит в предварительной идентификации системы и последующем решении задачи уже имеющимся способом, основанным на знании модели, как в главе \ref{chap2}. Однако, такой подход не всегда целесообразен.

В этой главе будет предложен альтернативный подход, не нуждающийся в явном параметрическом представлении системы вовсе. Основой ему послужит бихевиористский подход к динамическим системам, изложенный в главе \ref{chap1}, а также принцип разделимости управления и наблюдения, уже использовавшийся в главе \ref{chap2}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Постановка задачи по сгенерированным данным}\label{data-driven-approach}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Будем считать, что сведения о линейной системе $G$ сводятся к верхней оценке ее размерности $n$ и одной предварительно сгенерированной траектории $\{u^d(t), y^d(t)\}_{t = 0}^{T^d - 1}$, причем эта траектория измерена точно. 

Как и ранее,  траектории "прошлого"\ $$\{(u^p(0), u^p(1), \ldots, u^p(\tau-1)), (y^p(0), y^p(1), \ldots, y^p(\tau-1))\} = \{u_\tau^p, y_\tau^p \},$$ известные к текущему моменту $\tau$ в процессе управления системой, будем считать измеренными с точностью до ограниченной ошибки: т.е. доступны лишь $\{u_\tau^p, \tilde{y}_\tau^p\}$, где ${\tilde{y}^p_\tau = y^p_\tau + \xi_\tau}$.

В текущий момент времени $\tau$, подобно предыдущей главе, ставится задача минимизации квадратичного критерия качества
$$
    \sum_{t = \tau}^{T-1} \norm{u(t)}^2,
    $$
при гарантированном соблюдении линейных условий
$$
    G(t)y(t) \leq g(t), \quad u_{\min} \leq u(t) \leq u_{\max}, \quad \tau \leq t \leq T-1,
    $$
на входные и выходные сигналы.

Покажем, как априорная траектория $\{u^d, y^d\}$ при определенных условиях может иметь ту же информационную ценность, что и модель системы $(A,B,C,D)$, в случае ее наличия.

Теорема \ref{trajectory check} в непосредственно приведенной формулировке позволяет проверять любую траекторию фиксированной длины на принадлежность множеству траекторий системы. В рассматриваемом случае стоит обратная задача: чтобы определить, допустимо ли конкретное управление в конкретный момент времени, хотелось бы уметь в некотором смысле симулировать систему.

Теорему \ref{trajectory check} можно использовать для генерации множества возможных траекторий $\{u^p_\tau, u, y^p_\tau, y\}$ длины $T$ с некоторой фиксированной "прошлой"\ начальной частью $\{u^p_\tau, y^p_\tau\}$ длины $\tau$. Нефиксированную часть ${\{u, y\} = \{u(\tau), \ldots, u(T-1), y(\tau), \ldots, y(T-1)\}}$ будем называть "будущей"\ частью траектории.
Соответственно, будем делить на "прошлое"\ и "будущее"\ для момента $\tau$ и строки матриц Ганкеля для априорной траектории:
\begin{equation}
H_T(u^d) = \begin{pmatrix}
  u^d(0) & \cdots & u^d(T^d-T)\\
  \vdots & \ddots & \vdots \\
  u^d(\tau-1) & \cdots & u^d(\tau-1 + T^d - T) \\
  \hline
  u^d(\tau) & \cdots & u^d(\tau + T^d-T)\\
  \vdots & \ddots & \vdots \\
  u^d(T-1) & \cdots & u^d(T^d-1)
\end{pmatrix} =
		\begin{pmatrix}
		U_{\tau}^p \\
		U_{\tau}^f
		\end{pmatrix},
\end{equation}
\begin{equation}
H_T(y^d) = \begin{pmatrix}
  y^d(0) & \cdots & y^d(T^d-T)\\
  \vdots & \ddots & \vdots \\
  y^d(\tau-1) & \cdots & y^d(\tau-1 + T^d - T) \\
  \hline
  y^d(\tau) & \cdots & y^d(\tau + T^d-T)\\
  \vdots & \ddots & \vdots \\
  y^d(T-1) & \cdots & y^d(T^d-1)
\end{pmatrix} =
		\begin{pmatrix}
		Y_{\tau}^p \\
		Y_{\tau}^f
		\end{pmatrix},
\end{equation}

Если входной сигнал $u^d$ является постоянно возбуждающим порядка ${n + T}$, то, согласно теореме \ref{trajectory check}, $\{u_{\tau}^p, u, y_{\tau}^p, y\}$ является траекторией системы $G$ тогда и только тогда, когда уравнение
\begin{equation}\label{traj-cond}
\begin{pmatrix}
U_{\tau}^p \\
Y_{\tau}^p \\
U_{\tau}^f \\
Y_{\tau}^f
\end{pmatrix} \alpha = \begin{pmatrix}
u_{\tau}^p \\
y_{\tau}^p \\
u \\
y
\end{pmatrix}
\end{equation}
имеет решение $\alpha \in \mathbb{R}^{T^d - T +1}$.
Поэтому для построения возможных траекторий можно воспользоваться следующим алгоритмом:\\
1. Зафиксировать интересующее значение "будущего"\ входного сигнала $u$.\\
2. Для выбранного $u$ найти некоторое решение $\alpha \in \mathbb{R}^{T^d-T+1}$ системы линейных алгебраических уравнений
\begin{equation}
\begin{pmatrix}
U_{\tau}^p \\
Y_{\tau}^p \\
U_{\tau}^f
\end{pmatrix} \alpha = \begin{pmatrix}
u_{\tau}^p \\
y_{\tau}^p \\
u
\end{pmatrix}.
\end{equation}
3. Вычислить $y = Y_{\tau}^f \alpha$. Получили одну из возможных траекторий для фиксированных $u^p_\tau, y^p_\tau, u$.

\begin{remark}
В силу теоремы \ref{trajectory check}, для любых $u^p_\tau, y^p_\tau, u$ хотя бы одну возможную выходную траекторию $y$ мы найти сможем, а вот для единственности $y$, которая представляет особый практический интерес, нужно наложить некоторые условия. Поскольку для линейной системы размерности $n$ траектория длины $n$ однозначно определяет начальное состояние, то для обеспечения единственности достаточно потребовать $\tau \geq n$. Потому в дальнейшем полагаем, что управление начинается в момент $n$, --- это своего рода неявный аналог явного ограничения $x_0 \in X_0$ в постановке задачи при известной модели.
\end{remark}

\begin{remark}\label{lower bound on T^d}
Чем больше горизонт планирования $T$, тем больше и длина априорной траектории $T^d$. Поскольку нам необходим постоянно возбуждающий порядка $n + T$ сигнал $u^d$, то,  как уже отмечалось в Замечании \ref{remark on input length}, для длины $T^d$ этого сигнала справедлива оценка $T^d \geq (n + T)(m + 1) - 1,$ где $m$ --- размерность входа.
\end{remark}

Вместо явного задания динамики системы моделью $(A,B,C,D)$ в пространстве состояний, будем пользоваться неявным описанием  поведения системы в виде (\ref{traj-cond}). Начальное состояние системы также фиксируем неявно, начиная управление в момент $n$.


Таким образом, в каждый момент времени $n \leq \tau \leq T$ решаем следующую задачу оптимального программного управления, обладая неточной траекторией $\{u_\tau^p, \tilde{y}_\tau^p\}$:
\begin{equation}\label{dd-oc-at-tau}
\min\limits_{u(\tau)} || u(\tau) ||^2,
\end{equation}
$$
\begin{pmatrix}
U_\tau^p \\
Y_\tau^p \\
U_\tau^f \\
\end{pmatrix} \alpha(\tau) = \begin{pmatrix}
u_\tau^p \\
y_\tau^p \\
u(\tau) \\
\end{pmatrix},
$$
$$
\tilde{y}_\tau^p = y_\tau^p + \xi_\tau, \quad -\varepsilon\mathbbm{1} \leq \xi_\tau \leq \varepsilon \mathbbm{1},
$$
$$
G (t) Y^d(t) \alpha(\tau) \leq g(t), \quad \forall \alpha(\tau), \xi_\tau,
$$
$$u_{\min} \leq u(t) \leq u_{\max}, \quad \tau \leq t \leq T-1,
$$

где $Y^d(t)$ --- блок матрицы $Y_\tau^f$ (или $H_T(y^d)$):
$$
     Y^d(t) = (y^d(t), y^d(t+1), \ldots, y^d(t+T^d-T)).
     $$

%где матрица
%\[
%G_\tau =
%\begin{pmatrix}
%  \begin{matrix}
%  G(\tau)
%  \end{matrix}
%  & \rvline & \bigzero & \rvline & \cdots & \rvline & \bigzero\\
%\hline
%  \bigzero & \rvline &
%  \begin{matrix}
%    G(\tau + 1)
%  \end{matrix}
%  & \rvline & \cdots  & \rvline & \bigzero \\
%\hline
%  \vdots & \rvline & \vdots & \rvline &
%  \begin{matrix}
%    \ddots
%  \end{matrix}
%  & \rvline & \bigzero \\
%\hline
%  \bigzero & \rvline & \bigzero & \rvline & \bigzero & \rvline &
%  \begin{matrix}
%    G(T-1)
%  \end{matrix}
%\end{pmatrix},
%\]
%вектор $g_{\tau} = (g(\tau), g(\tau+1), \cdots, g(T-1)),$ \\
%$u_{\min}(\tau) = (\underbrace{u_{\min}, \ldots, u_{\min}}_{T - \tau \textup{ раз}}), \quad u_{\max}(\tau) = (\underbrace{u_{\max}, \ldots, u_{\max}}_{T - \tau \textup{ раз}}).$

Из полученного в момент $\tau$ оптимального управляющего воздействия $u^*(\tau, u^p_\tau, \tilde{y}^p_\tau) = (u^*(\tau|\tau, u^p_\tau, \tilde{y}^p_\tau), u^*(\tau+1|\tau, u^p_\tau, \tilde{y}^p_\tau), \ldots, u^*(T-1|\tau, u^p_\tau, \tilde{y}^p_\tau))$  подаем на вход системы $u^p(\tau) := u^*(\tau|\tau, u^p_\tau, \tilde{y}^p_\tau)$. Переходим к решению задачи (\ref{dd-oc-at-tau}) в момент $\tau+1$, зная траекторию $\{u^p_{\tau+1}, \tilde{y}^p_{\tau+1}\}$. 
%Таким образом, если существовало допустимое воздействие в момент $\tau$, то гарантированно существует допустимое воздействие в момент $\tau + 1$, причем значение критерия качества на каждом шагу не увеличивается.

\section{Принцип разделимости}

Для задачи (\ref{dd-oc-at-tau}) многообещающим выглядит разделение задач наблюдения и управления, использованное в предыдущей главе. Продемонстрируем, как элегантно реализуется принцип разделимости в бихевиористском подходе.

\begin{lemma}\label{dd-separation}
Пусть $\{u_{\tau}^p, y_{\tau}^p \}$ --- некоторая фиксированная траектория системы (\ref{traj-cond}) длины $\tau \geq n$. Тогда любая траектория $\{u_{\tau}^p, u, y_{\tau}^p, y\}$ длины $T$ системы (\ref{traj-cond}) однозначно представима в виде суммы траекторий $\{0, u, 0, y_0\}$ и $\{u_{\tau}^p, 0, y_{\tau}^p, \hat{y}\}$ длины $T$, причем для фиксированного $u$ определить неизвестные участки $y_0, \hat{y}$ можно следующим образом:\\
1. Найти некоторые решения $\hat{\alpha}, \alpha_0$ алгебраичеких уравнений
\begin{equation}
\begin{pmatrix}
U_\tau^p \\
Y_\tau^p \\
U_\tau^f \\
\end{pmatrix} \hat{\alpha} = \begin{pmatrix}
u_\tau^p \\
y_\tau^p \\
0 \\
\end{pmatrix}, \quad
\begin{pmatrix}
U_\tau^p \\
Y_\tau^p \\
U_\tau^f \\
\end{pmatrix} \alpha_0 = \begin{pmatrix}
0 \\
0 \\
u \\
\end{pmatrix}.
\end{equation}
2. Вычислить $\hat{y} = Y_\tau^f\hat{\alpha}, \quad y_0 = Y_\tau^f\alpha_0$.
\end{lemma}

\begin{proof}
Будем следовать идее декомпозиции будущего выходного сигнала $y$ (см. главу \ref{chap2})
\begin{equation}\label{DBOC-y-separation}
    y =  y_0 + \hat y,
    \end{equation}
где $y_0 = \{y_0(t)\}_{t=\tau}^{T-1}$ --- выходной сигнал системы $G$, соответствующий управлению $u$ и тривиальному начальному условию $x(\tau) = 0$; $\hat y = \{\hat y(t)\}_{t=\tau}^{T-1}$ --- выходной сигнал неуправляемой системы $G$ для некоторого начального условия $x(\tau)$, согласующегося с текущей позицией процесса $\{u_\tau^p, \tilde y_\tau^p\}$.

Рассмотрим подробно слагаемые в (\ref{DBOC-y-separation}). При определении $y_0$ тривиальное начальное состояние  $x(\tau)=0$ можно зафиксировать неявно посредством тривиальной прошлой траектории $\{0,0\}$ длины не менее $n$. С тривиальной траекторией, очевидно, согласуется начальное условие $x(0)=0$, а поскольку $\tau \geq n$, это единственно возможное начальное состояние. Тогда система остается в начале координат вплоть до момента $\tau$: $x(t)=0$, $t=0, \ldots, \tau$. Из рассуждений следует, что $\{0, u, 0, y_0\}$ является траекторией длины $T$ системы $G$.



Далее $\{0,\hat y\}$ --- траектория системы $G$ c начальным условием  $x(\tau)$ из множества состояний, в которые система могла прийти, точно следуя траектории $\{u_\tau^p, y_\tau^p\}$, где о выходном сигнале $y_\tau^p$ известно только, что он отклоняется от измеренного $\tilde y_\tau^p$ в равномерной норме не более чем на $\varepsilon$. Тогда $\{u_{\tau}^p, 0, y_{\tau}^p, \hat{y}\}$ --- траектория длины $T$ системы $G$.

Из необходимого условия теоремы \ref{trajectory check} следует, что для траекторий $\{0, u, 0, y_0\}$ и $\{u_{\tau}^p, 0, y_{\tau}^p, \hat{y}\}$ существуют $ \alpha_0(\tau), \hat \alpha(\tau)$, соответственно, удовлетворяющие
\begin{equation}\label{two traj}
\begin{pmatrix}
U_{\tau}^p \\
Y_{\tau}^p \\
U_{\tau}^f \\
Y_{\tau}^f
\end{pmatrix} \alpha_0(\tau) = \begin{pmatrix}
0 \\
0 \\
u \\
y_0
\end{pmatrix},
 \quad
 \begin{pmatrix}
U_{\tau}^p \\
Y_{\tau}^p \\
U_{\tau}^f \\
Y_{\tau}^f
\end{pmatrix} \hat{\alpha}(\tau) = \begin{pmatrix}
u_{\tau}^p \\
y_{\tau}^p \\
0 \\
\hat{y}
\end{pmatrix}.
\end{equation}
Суммируя  равенства  (\ref{two traj}), получаем
\begin{equation}\label{one traj}
\begin{pmatrix}
U_{\tau}^p \\
Y_{\tau}^p \\
U_{\tau}^f \\
Y_{\tau}^f
\end{pmatrix} (\hat{\alpha}(\tau) + \alpha_0(\tau)) = \begin{pmatrix}
u_{\tau}^p \\
y_{\tau}^p \\
u \\
\hat{y} + y_0
\end{pmatrix}.
\end{equation}
В силу теоремы \ref{trajectory check}, условие (\ref{one traj}) является достаточным для того, чтобы ${\{u_{\tau}^p, u, y_{\tau}^p, \hat{y} + y_0\}}$ являлась траекторией системы. Поскольку начальное состояние $x_0$ неявно зафиксировано достаточно длинным участком $\{u_{\tau}^p, y_{\tau}^p\}$, эта траектория совпадает с искомой $\{u_{\tau}^p, u, y_{\tau}^p, y\}$, т.е. $y = \hat{y} + y_0$, что завершает доказательство леммы. $\Box$
\end{proof}

\begin{remark}\label{y(t)-from-y}
Для получения $\hat y(t), y_0(t)$ в конкретный момент времени $t$, на шаге 2 необходимо использовать блок $Y^d(t)$ матрицы $Y_\tau^f$:
$$
     Y^d(t) = (y^d(t), y^d(t+1), \ldots, y^d(t+T^d-T)).
     $$
Получим $\hat y(t) = Y^d(t)\hat \alpha(\tau)$, $y_0(t) = Y^d(t) \alpha_0(\tau)$.
\end{remark}


По аналогии с определением~\ref{consistent-x} дадим
\begin{definition} Назовем параметр $\hat\alpha(\tau)$ согласующимся с позицией $\{u^p_\tau, \tilde y_\tau^p\}$ если
\begin{equation*}\label{DBOC-hat-alpha}
    \begin{pmatrix}
        U_\tau^p \\
        Y_\tau^p \\
        U_\tau^f \\
        \end{pmatrix} \hat{\alpha}(\tau) = \begin{pmatrix}
        u_\tau^p \\
        y_\tau^p \\
        0 \\
        \end{pmatrix}, \ \
    ||y^p(t) - \tilde y^p(t)||_{\infty} \le \varepsilon, \ \
     t = 0, \ldots, \tau-1.
\end{equation*}
\end{definition}

Пусть ${\cal A}(\tau, u_\tau^p, \tilde y_{\tau}^p)$ --- множество всех $\hat \alpha(\tau)$, согласующихся с  $\{u^p_\tau, \tilde y^p_\tau\}$:
\begin{align*}
    {\cal A}(\tau, u_\tau^p, \tilde y^p_\tau) = \bigg\{ \hat \alpha(\tau)\in \mathbb{R}^{T^d-T+1} : & \ \  U_\tau^p\hat{\alpha}(\tau) = u^p_\tau,  \ \ U^f_\tau\hat{\alpha}(\tau) = 0, &\\
    & -\varepsilon \mathbbm{1} \le Y^p_\tau\hat{\alpha}(\tau) -\tilde y^p_\tau \le  \varepsilon\mathbbm{1}\bigg\}, &
    \end{align*}
где $\mathbbm{1}$ --- $m(T-\tau)$-вектор из единиц.
Множество ${\cal A}(\tau, u_\tau^p, \tilde y^p_\tau)$ --- аналог множества $X(\tau, u_\tau^p, \tilde y^p_\tau)$ состояний $x(\tau)$, согласующихся с текущей позицией $\{u_\tau^p, \tilde y^p_\tau\}$.



Далее определим ${\cal Y}(t| \tau, u_\tau^p, \tilde y^p_\tau)$ как множество всех $\hat y(t)$, согласующихся с позицией $\{u^p_\tau, \tilde y^p_\tau\}$. В соответствии с замечанием \ref{y(t)-from-y}, это множество порождается множеством ${\cal A}(\tau, u_\tau^p, \tilde y_{\tau}^p)$:
$$
    {\cal Y}(t | \tau, u_\tau^p, \tilde y^p_\tau) = \bigg\{ \hat y(t) = Y^d(t) \hat \alpha(\tau) :  \  \hat \alpha(\tau) \in {\cal A}(\tau, u_\tau^p, \tilde y^p_\tau)\bigg\}.
    $$

В связи с  декомпозицией (\ref{DBOC-y-separation}) выходного сигнала, ограничение $G(t)y(t) \leq g(t)$ в момент $t$ принимает вид
$G(t)(y_0(t)+\hat y(t)) \leq g(t)$. Тогда  на $y_0(t)$ наложим "суженное"{} условие:
\begin{equation}\label{tightened constraint}
G(t)y_0(t) \leq g(t)-\chi(t|\tau),
\end{equation}
где  $\chi(t|\tau) = (\chi_i(t|\tau), i = 1,\ldots, q)$ соответствует наихудшей реализации выходного сигнала $\hat y(t)$ в позиции $\{u_\tau^p, \tilde y^p_\tau\}$, а именно, каждый его элемент $\chi_i(t|\tau)$ является решением задачи
\begin{equation} \label{estimation-set-description}
    \chi_i(t|\tau) = \max\limits_{\hat{y}(t)} \ G_i(t)\hat{y}(t),
\end{equation}
    $$\hat{y}(t) \in {\cal Y}(t| \tau, u_\tau^p, \tilde y_{\tau}^p),$$
где $G_i(t)$ --- $i$-ая строка матрицы $G(t).$

С учетом определений множеств ${\cal Y}(t| \tau, u_\tau^p, \tilde y_{\tau}^p)$, ${\cal A}(\tau, u_\tau^p, \tilde y_{\tau}^p)$, задачи (\ref{estimation-set-description}) представляют собой  задачи линейного программирования:
\begin{equation} \label{estimation-lp}
    \chi_i(t|\tau) =   \max\limits_{\hat\alpha(\tau)} \ G_i(t)Y^d(t)\hat{\alpha}(\tau),
\end{equation}
      $$\begin{pmatrix}
        U_\tau^p \\
        U_\tau^f \\
        \end{pmatrix} \hat{\alpha}(\tau) = \begin{pmatrix}
        u_\tau^p \\
        0 \\
        \end{pmatrix},$$
      $$\tilde{y}_{\tau}^p-\varepsilon \mathbbm{1} \leq Y_\tau^p \hat{\alpha}(\tau) \leq \tilde{y}_\tau^p + \varepsilon \mathbbm{1}.$$

Задачи (\ref{estimation-lp}) --- \textit{задачи оптимального наблюдения}, см. \cite{Dmitruk2004} и главу \ref{chap2}.


Выполнение  для $y_0(t)$  ограничения (\ref{tightened constraint}) очевидно влечет удовлетворение исходного ограничения $G(t)y(t) \leq g(t)$ на $y(t)$ для любой возможной реализации $\hat{y}(t)$,  согласующейся с позицией $\{u^p_\tau, \tilde y^p_\tau\}$.

Параметр $\alpha_0(\tau)$, удовлетворяющий второму из условий (\ref{two traj}) и такой, что для $y_0(t) = Y^d(t)\alpha_0(\tau)$ при всех $t = \tau, \ldots, T-1$ выполняется неравенство (\ref{tightened constraint}), определяет допустимое управление $u = U_\tau^f \alpha_0(\tau)$. Тогда \textit{ задача  оптимального управления} в момент времени $\tau$ имеет вид:
\begin{equation}\label{control}
\min\limits_{\alpha_0(\tau), u} \norm{u}^2,
\end{equation}
    $$\begin{pmatrix}
    U_\tau^p \\
    Y_\tau^p \\
    U_\tau^f \\
    \end{pmatrix} \alpha_0(\tau) = \begin{pmatrix}
    0 \\
    0 \\
    u \\
    \end{pmatrix},$$
    $$ G(t)Y^d(t)\alpha_0(\tau) \leq g(t) - \chi(t|\tau),$$
    $$u_{\min} \leq u(t) \leq u_{\max},  \ \ t = \tau, \ldots, T-1.$$



Исключая в (\ref{control}) управление $u$, получаем задачу квадратичного программирования относительно $\alpha_0(\tau)$:
\begin{equation}\label{control-qp}
    \min\limits_{\alpha_0(\tau)} \alpha_0(\tau)^T(U_{\tau}^f)^TU_{\tau}^f\alpha_0(\tau),
\end{equation}
    $$\begin{pmatrix}
        U_\tau^p \\
        Y_\tau^p \\
    \end{pmatrix} \alpha_0(\tau) = \begin{pmatrix}
    0 \\
    0 \\
    \end{pmatrix},$$
    $$ G(t)Y^d(t)\alpha_0(\tau) \leq g(t)- \chi(t|\tau),$$
    $$ u_{\min} \leq U^d(t)\alpha_0(\tau) \leq u_{\max}, \ \
        t = \tau, \ldots, T-1,$$
где, по аналогии с $Y^d(t)$,  $U^d(t) = (u^d(t), u^d(t+1), \ldots, u^d(t+T^d-T))$.


Пусть  $\alpha_0^*(\tau, u_\tau^p, \tilde{y}_\tau^p)$ --- решение задачи  оптимального управления (\ref{control-qp}). На вход системы $G$ подаем первое значение соответствующего управления, которое вычисляется согласно формуле $u^*(\tau|\tau, u_\tau^p, \tilde{y}_\tau^p) = U^d(\tau)\alpha_0^*(\tau, u_\tau^p, \tilde{y}_\tau^p)$.

Таким образом, алгоритм управления системой на основе априорных данных $\{u^d, y^d\}$ состоит в следующем

\noindent при всех $\tau = n,\ldots, T-1$:

1) решить задачи (\ref{estimation-lp}), найти оценки $\chi_i(t|\tau)$, $i = 1, \ldots, q$,\\
 $t = \tau, \ldots, T-1$;

2) решить задачу (\ref{control-qp}), найти  $\alpha_0^*(\tau, u_\tau^p, \tilde{y}_\tau^p)$;

3) подать на вход системы управление $u^p(\tau) = U^d(\tau)\alpha_0^*(\tau, u_\tau^p, \tilde{y}_\tau^p)$.

Как и в главе \ref{chap2}, полученное в результате применения алгоритма управление $u^p(\tau)$, $\tau = n, \ldots, T-1$, является \textit{реализацией в конкретном процессе управления оптимальной обратной связи по неточным измерениям}.


Для того, чтобы результаты представленного алгоритма совпадали с результатом главы \ref{chap2} необходимо потребовать  $X_0 = \mathbb{R}^n$, совпадения управлений $u^p(t)$ при $t = 0,1,\ldots, n-1$,  и также начинать процесс управления в момент $\tau = n$.


%В связи с вышеизложенным, ограничение на выходные сигналы принимает вид
%$G_{\tau}(y_0(\tau)+\hat{y}(\tau)) \leq g_{\tau}$. Наложим на $y_0(\tau)$ суженное условие:
%\begin{equation}\label{tightened constraint}
%G_{\tau}y_0(\tau) \leq g_{\tau}-\chi(\tau),
%\end{equation}
%где каждая компонента $\chi_i(\tau)$ соответствует наихудшей реализации состояния системы в момент $\tau$, а именно является решением задачи линейного программирования
%\begin{equation} \label{estimation}
%\chi_i(\tau) = \max\limits_{\hat{\alpha}(\tau), \xi_{\tau}, \hat{y}(\tau)} G_{\tau i}\hat{y}(\tau),
%\end{equation}
%$$\begin{pmatrix}
%U_\tau^p \\
%Y_\tau^p \\
%U_\tau^f \\
%Y_\tau^f \\
%\end{pmatrix} \hat{\alpha}(\tau) = \begin{pmatrix}
%u_\tau^p \\
%\tilde{y}_\tau^p + \xi_{\tau}\\
%0 \\
%\hat{y}(\tau)\\
%\end{pmatrix},
%$$
%$$-\varepsilon \mathbbm{1} \leq \xi_{\tau} \leq \varepsilon \mathbbm{1}.$$
%Задача (\ref{estimation}) в компактной формулировке (исключается $\xi_{\tau}$) имеет вид
%\begin{equation} \label{estimation-lp}
%\chi_i(\tau) = \max\limits_{\hat{\alpha}(\tau)} G_{\tau i}Y_{\tau}^f\hat{\alpha}(\tau),
%\end{equation}
%$$\begin{pmatrix}
%U_\tau^p \\
%U_\tau^f \\
%\end{pmatrix} \hat{\alpha}(\tau) = \begin{pmatrix}
%u_\tau^p \\
%0 \\
%\end{pmatrix},
%$$
%$$
%\tilde{y}_{\tau}^p-\varepsilon \mathbbm{1} \leq
%Y_\tau^p \hat{\alpha} \leq
%\tilde{y}_\tau^p + \varepsilon \mathbbm{1}.
%$$
%Выполнение  для $y_0$ суженного ограничения (\ref{tightened constraint}) очевидно влечет удовлетворение исходного ограничения на $y$ для любой возможной реализации $\hat{y}$.
%
%
%
%
%%\begin{comment}
%%\begin{definition}
%%\textit{Уровнем ошибки} в задаче \ref{estimation-lp} будем называть $\varepsilon$, а \textit{номинальной задачей наблюдения при уровне ошибки} $\varepsilon$ будем называть задачу \ref{estimation-lp} для истинной траектории, т.е. для случая $\tilde{y}_\tau = y_\tau.$
%%\end{definition}
%%Очевидно, если задача \ref{estimation-lp} разрешима при любой покомпонентно ограниченной $\varepsilon$ ошибке, то должна быть разрешима номинальная задача. Еще один результат, касающийся вопроса гарантированной разрешимости приведем ниже.
%%\begin{lemma}\label{estimation-guarantees}
%%Если номинальная задача наблюдения при уровне ошибки $\varepsilon$ разрешима, то для любого неточного выходного сигнала $\tilde{y}_\tau = y_\tau + \xi_\tau$, где ошибка ограничена поэлементно $\norm{\xi_\tau}_\infty \leq \frac{\varepsilon}{2}$ соответствующая задача\ref{estimation-lp} также имеет решение.
%%\end{lemma}
%%\begin{proof}
%%Для любого $\tilde{y}_\tau = y_\tau + \xi_\tau$ с ограниченной ошибкой $\norm{\xi_\tau}_\infty \leq \frac{\varepsilon}{2}$ задача \ref{estimation-lp} имеет те же самые целевую функцию и ограничения в виде равенств, а также не менее сильные ограничивающие неравенства:
%%$$y_\tau - \varepsilon \mathbbm{1} \leq \tilde{y}_\tau - \frac{\varepsilon}{2}\mathbbm{1} \leq Y_\tau^p\hat{\alpha} \leq \tilde{y}_\tau + \frac{\varepsilon}{2}\mathbbm{1} \leq y_\tau + \varepsilon \mathbbm{1}.$$
%%\end{proof}
%%\end{comment}
%
%
%
%
%
%Детерминированная задача оптимального программного управления с суженными условиями на $y_0$ принимает следующий вид:
%
%\begin{equation}\label{control}
%\min\limits_{\alpha_0(\tau), u(\tau), y_0(\tau)}u(\tau)^Tu(\tau),
%\end{equation}
%$$\begin{pmatrix}
%U_\tau^p \\
%Y_\tau^p \\
%U_\tau^f \\
%Y_\tau^f \\
%\end{pmatrix} \alpha_0(\tau) = \begin{pmatrix}
%0 \\
%0 \\
%u \\
%y_0(\tau) \\
%\end{pmatrix},$$
%$$G_{\tau}y_0(\tau) \leq g_{\tau} - \chi(\tau),$$
%$$u_{\min}(\tau) \leq u(\tau) \leq u_{\max}(\tau).$$
%
%Снова переходим к эквивалентному, но более компактному виду, получаем
%\begin{equation}\label{control-qp}
%\min\limits_{\alpha_0(\tau)}\alpha_0(\tau)^T{U_{\tau}^f}^TU_{\tau}^f\alpha_0(\tau),
%\end{equation}
%$$
%\begin{pmatrix}
%U_\tau^p \\
%Y_\tau^p \\
%\end{pmatrix} \alpha_0(\tau) = \begin{pmatrix}
%0 \\
%0 \\
%\end{pmatrix},
%$$
%$$G_{\tau}Y_{\tau}^f\alpha_0(\tau) \leq g_{\tau} - \chi(\tau),$$
%$$u_{\min}(\tau) \leq U_{\tau}^f\alpha_0(\tau) \leq u_{\max}(\tau).$$
%Получив решение $\alpha_0^*(\tau, u_\tau^p, \tilde{y}_\tau^p)$ задачи  (\ref{control-qp}), вычисляем оптимальное управление ${u^*(\tau, u_\tau^p, \tilde{y}_\tau^p) = U_\tau^f \alpha_0^*(\tau, u_\tau^p, \tilde{y}_\tau^p)}$. Из вычисленного ${u^*(\tau, u_\tau^p, \tilde{y}_\tau^p) = (u^*(\tau|\tau, u_\tau^p, \tilde{y}_\tau^p), \ldots, u^*(T-1|\tau, u_\tau^p, \tilde{y}_\tau^p))}$ подаем на вход системе ${u^p(\tau) = u^*(\tau|\tau, u_\tau^p, \tilde{y}_\tau^p).}$
%
%\bigskip
%Таким образом, задача оптимального управления, решаемая в каждой временной точке $n \leq \tau \leq T-1$, свелась к нескольким задачам линейного программирования и одной выпуклой задаче квадратичного программирования.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Рекуррентная разрешимость задачи оптимального управления и задач оптимального наблюдения}
Дадим теоретическое обоснование реализуемости предложенного алгоритма управления. В частности, покажем, что при условии существования решений задач (\ref{estimation-lp}) и (\ref{control}) в момент времени $\tau = n$, решения этих задач существуют и для всех $\tau = n+1, \ldots, T-1$. С целью сокращения записи далее  опустим явное упоминание пары $\{u^p_\tau, \tilde y^p_\tau\}$ в решениях задачи (\ref{control-qp}) для момента $\tau$, т.е.
$\alpha_0^*(\tau) = \alpha_0^*(\tau, u^p_\tau, \tilde y^p_\tau)$,
$u^*(\tau|\tau) = u^*(\tau|\tau, u^p_\tau, \tilde y^p_\tau)$, а также для момента $\tau+1$ и позиции $\{u^p_\tau, u^*(\tau|\tau), \tilde y^p_\tau, \tilde y^p(\tau)\}$, которая реализуется при подаче управления $u^*(\tau|\tau) = u^p(\tau)$ в момент $\tau$.

\begin{theorem}\label{main-theorem}
Пусть в момент $\tau$ для позиции $\{u^p_\tau, \tilde y^p_\tau\}$ каждая из задач (\ref{estimation-lp}) имеет решение. Далее, пусть имеет решение задача (\ref{control-qp}) с параметрами $\chi(t|\tau)$, поставленными решениями задач (\ref{estimation-lp}). Тогда в момент $\tau+1$ для позиции $\{u^p_\tau, u^*(\tau|\tau), \tilde y^p_\tau, \tilde y^p(\tau)\}$
задачи (\ref{estimation-lp}), (\ref{control-qp})   также имеют решение. Более того, $$
    \sum\limits_{t=\tau+1}^{T-1}\norm{u^*(t|\tau+1)}^2 \leq \sum\limits_{t=\tau+1}^{T-1}\norm{u^*(t|\tau)}^2.
    $$
\end{theorem}

\begin{proof} Сначала докажем разрешимость каждой из задач оптимального наблюдения в момент $\tau+1$. Эти задачи можно записать в виде
\begin{equation}\label{estimation-lp-tau+1}
    \chi_i(t|\tau+1) =  \max\limits_{\hat{\alpha}(\tau+1)} G_i(t)Y^d(t)\hat{\alpha}(\tau+1),
    \end{equation}
    $$ \begin{pmatrix}
        U_{\tau}^p \\
        U^d(\tau)\\
        U_{\tau+1}^f
    \end{pmatrix} \hat{\alpha}(\tau+1) =
    \begin{pmatrix}
        u_{\tau}^p \\
        u^*(\tau|\tau)\\
        0
    \end{pmatrix}, $$
    $$ \tilde{y}_{\tau}^p-\varepsilon \mathbbm{1} \leq
    Y_{\tau}^p \hat\alpha(\tau+1) \leq
    \tilde{y}_{\tau}^p + \varepsilon \mathbbm{1},$$
    $$ \tilde y^p(\tau) - \varepsilon \mathbbm{1} \leq
    Y^d(\tau) \hat \alpha(\tau+1) \leq
    \tilde y^p(\tau) + \varepsilon \mathbbm{1}, $$

а задачи наблюдения для момента $\tau$ представимы в виде
\begin{equation}\label{estimation-lp-tau}
    \chi_i(t|\tau) = \max\limits_{\hat{\alpha}(\tau)} G_i(t)Y^d(t)\hat{\alpha}(\tau),
    \end{equation}
    $$ \begin{pmatrix}
        U_{\tau}^p \\
        U^d(\tau)\\
        U_{\tau+1}^f \\
    \end{pmatrix} \hat{\alpha}(\tau) =
    \begin{pmatrix}
        u_{\tau}^p \\
        0\\
        0 \\
    \end{pmatrix},$$
    $$\tilde{y}_{\tau}^p-\varepsilon \mathbbm{1} \leq
    Y_{\tau}^p \hat\alpha(\tau) \leq
    \tilde{y}_\tau^p + \varepsilon \mathbbm{1}.$$

Каждая задача (\ref{estimation-lp-tau+1}) допустима, поскольку для истинной реализовавшейся траектории $\{u^p_\tau, u^*(\tau|\tau), y^p_\tau, y^p(\tau)\}$ и будущего тривиального управления $\{u(t)\}_{t=\tau+1}^T = 0$ существует $\hat\alpha^p(\tau+1)$, для которого выполняется второе из условий (\ref{two traj}) Леммы \ref{dd-separation}, а значит, для этого $\hat\alpha^p(\tau+1)$ удовлетворены все ограничения (\ref{estimation-lp-tau+1}).

Для доказательства разрешимости задачи (\ref{estimation-lp-tau+1})
используем решение $\alpha_0^*(\tau)$  задачи оптимального управления (\ref{control-qp}) в момент $\tau$.
Обозначим
\begin{equation}\label{uc}
    u^c = U^f_{\tau+1}\alpha_0^*(\tau),
    \end{equation}
    $$y_0^*(\tau|\tau) = Y^d(\tau)\alpha_0^*(\tau).$$
Заметим, что $u^c = \{u^*(t|\tau)\}_{t = \tau+1}^{T-1}$, т.е. это "хвост"{} оптимального управления задачи (\ref{control-qp}). Согласно Лемме \ref{dd-separation} существует $\alpha^c$, такое что выполняется равенство
\begin{equation}\label{alpha_0-candidate}
\begin{pmatrix}
U_{\tau}^p \\
U^d(\tau)\\
Y_{\tau}^p \\
Y^d(\tau)\\
U_{\tau+1}^f \\
\end{pmatrix} \alpha^c = \begin{pmatrix}
0\\
0\\
0\\
0\\
u^c\\
\end{pmatrix}.
\end{equation}

Сдвинем переменную ${\hat \alpha(\tau+1)}$, относительно которой поставлены задачи оптимального наблюдения (\ref{estimation-lp-tau+1}), на константу, перейдем к новой переменной $\Delta\alpha(\tau+1)$:
$$
    \hat \alpha(\tau+1) = \alpha_0^*(\tau)-\alpha^c+\Delta\alpha(\tau+1).
    $$
Тогда
$$
    \chi_i(t|\tau+1) = G_i(t)Y^d(t)(\alpha_0^*(\tau)-\alpha^c) +
    \Delta \chi_i(t|\tau+1),
    $$
где, с учетом (\ref{uc}), (\ref{alpha_0-candidate}),
\begin{equation}
    \Delta\chi_i(t|\tau+1) =  \max_{\Delta\alpha(\tau+1)} G_i(t)Y^d(t)\Delta\alpha(\tau+1),
    \label{estimation-delta-alpha}
    \end{equation}
    $$ \begin{pmatrix}
        U_\tau^p \\
        U^d(\tau)\\
        U_\tau^f \\
    \end{pmatrix} \Delta\alpha(\tau+1) =
    \begin{pmatrix}
        u_\tau^p \\
        0 \\
        0\\
    \end{pmatrix},
    $$
    $$\tilde{y}_{\tau}^p-\varepsilon \mathbbm{1}  \leq
    Y_\tau^p \Delta \alpha(\tau+1)
    \leq \tilde{y}_\tau^p + \varepsilon \mathbbm{1},$$
    \begin{equation}
    \tilde y^p(\tau)-y_0^*(\tau|\tau) - \varepsilon \mathbbm{1} \leq Y^d(\tau) \Delta \alpha(\tau+1)
    \leq \tilde y^p(\tau)-y_0^*(\tau|\tau) +  \varepsilon \mathbbm{1},
\end{equation}     \label{estimation-new-constraint}
и множество допустимых решений $\Delta \alpha(\tau+1)$ непустое.


Сравним задачи (\ref{estimation-delta-alpha}) -- (\ref{estimation-new-constraint}) для $\Delta \alpha(\tau + 1)$ и (\ref{estimation-lp-tau}) для $\hat \alpha (\tau)$. Очевидно, что  дополнительное ограничение (\ref{estimation-new-constraint}) влечет $\Delta\chi_i(t|\tau+1) \le \chi_i(t|\tau)$ и справедлива оценка
\begin{equation}\label{chi-bound}
    \chi_i(t|\tau+1) \le G_i(t)Y^d(t)(\alpha_0^*(\tau)-\alpha^c) +
    \chi_i(t|\tau),
\end{equation}
для всех $i = 1, \ldots, q$, $t = \tau+1, \ldots, T-1$.

Таким образом, доказано, что в момент $\tau+1$ все задачи оптимального наблюдения имеют решение.


Остается продемонстрировать, что множество допустимых решений $\alpha_0(\tau+1)$ в задаче оптимального управления для момента $\tau+1$, которая имеет вид
$$
    \min\limits_{\alpha_0(\tau+1)} \alpha_0(\tau+1)^T(U_{\tau+1}^f)^T U_{\tau+1}^f\alpha_0(\tau+1), %\label{control-qp-tau+1}
    $$
       \begin{equation}\label{tau+1-eq}
        \begin{pmatrix}
        U_{\tau}^p \\
        U^d(\tau)\\
        Y_{\tau}^p \\
        Y^d(\tau) \\
    \end{pmatrix} \alpha_0(\tau+1) = \begin{pmatrix}
        0 \\
        0\\
        0\\
        0 \\
    \end{pmatrix},  
    \end{equation}
    \begin{equation} \label{tau+1-constr-y}
    (t)Y^d(t)\alpha_0(\tau+1) \leq g(t) - \chi(t|\tau+1),
    \end{equation} 
    \begin{equation}\label{tau+1-constr-u}
    {\min} \leq U^d(t)\alpha_0(\tau+1) \leq u_{\max},\ \
    t = \tau+1, \ldots, T-1,
    \end{equation} 
непусто --- тогда эта выпуклая задача квадратичного программирования имеет решение.

Покажем, что $\alpha^c$ --- допустимое решение. По построению $\alpha^c$ выполнены ограничения-равенства (\ref{tau+1-eq}) и группа ограничений на управления (\ref{tau+1-constr-u}). Покажем, что выполнены также условия (\ref{tau+1-constr-y}). Воспользовавшись сначала (\ref{chi-bound}), а затем тем фактом, что $\alpha_0^*(\tau)$ удовлетворяет ограничениям задачи (\ref{control-qp}), получаем
\begin{align*}
    G(t) Y^d(t) \alpha^c + \chi(t|\tau+1) & \leq G(t) Y^d(t) \alpha^c +  G(t)Y^d(t)(\alpha_0^*(\tau)-\alpha^c) + \chi(t|\tau) = \\
    & = G(t) Y^d(t)\alpha_0^*(\tau) + \chi(t|\tau) \leq g(t), \ \
    t = \tau+1, \ldots, T-1,
\end{align*}
что доказывает (\ref{tau+1-constr-y}).


Наконец, поскольку решение $\alpha^c$ допустимо, оптимальное решение удовлетворяет
\begin{equation*}
    \sum\limits_{t=\tau+1}^{T-1}\norm{u^*(t|\tau+1)}^2 \leq (\alpha^c)^T (U_{\tau+1}^f)^T U_{\tau+1}^f \alpha^c
    = \sum\limits_{t=\tau+1}^{T-1}\norm{u^*(t|\tau)}^2,
\end{equation*} что завершает доказательство всех утверждений теоремы.
$\Box$
\end{proof}

\begin{corollary}
Если задачи оптимального наблюдения (\ref{estimation-lp}) и управления (\ref{control-qp}) имеют решение в момент времени $\tau=n$, то они разрешимы и в каждый из последующих моментов $\tau = n+1, \ldots, T-1$. При этом критерий качества, значение которого определяется в момент $\tau$ как
$$
    J(\tau) = \sum\limits_{t=0}^{\tau-1}\norm{u^p(t)}^2 + \sum\limits_{t=\tau}^{T-1}\norm{u^*(t|\tau)}^2,
    $$
является невозрастающей функцией от $\tau$.
\end{corollary}

Доказательство теоремы~\ref{main-theorem}  использует "хвост"\ $u^c = \{u^*(t|\tau)\}_{t = \tau+1}^{T-1}$  оптимального управления, полученного в момент $\tau$ не только для доказательства допустимости задачи оптимального управления (как и в случае наличия модели системы), но и для доказательства существования решения задач оптимального наблюдения. Это позволяет учесть взаимосвязь не только между соответствующими задачами для $\tau$ и $\tau+1$, но и между самими задачами для момента $\tau+1$. В частности,  для задач оптимального наблюдения на основе $u^c$ приводится такая верхняя оценка решения $\chi(t|\tau+1)$, которая позволяет продемонстрировать и допустимость управления $\{u^*(t|\tau)\}_{t = \tau+1}^{T-1}$ в задаче оптимального управления для момента $\tau+1$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section{Недетерминированный случай: априорные измерения неточны}
%В этом разделе будет кратко приведена идея развития результатов.
%Интерес представляет случай, когда и априорные измерения содержат некоторую ошибку, т.е. $\tilde{y}^d = y^d + \xi^d.$
%
%Тогда $\tilde{Y}_{\tau}^p = Y_{\tau}^p + \mathit{\Xi}_{\tau}^p$,
%$\tilde{Y}_{\tau}^f = Y_{\tau}^f + \mathit{\Xi}_{\tau}^f$, где
%$$
%\begin{pmatrix}
%		\mathit{\Xi}_{\tau}^p\\
%		\mathit{\Xi}_{\tau}^f
%		\end{pmatrix}  = \begin{pmatrix}
%  \xi(0) & \cdots & \xi(T^d-T)\\
%  \vdots & \ddots & \vdots \\
%  \xi(\tau-1) & \cdots & \xi(\tau - 1 + T^d-T) \\
%  \hline
%  \xi(\tau) & \cdots & \xi(\tau + T^d-T)\\
%  \vdots & \ddots & \vdots \\
%  \xi(T-1) & \cdots & \xi(T^d-1)
%\end{pmatrix}
%    = H_T(\xi^d).
%$$
%
%В соответствии с этим задача оптимального оценивания (\ref{estimation}) перепишется следующим образом:
%
%\begin{equation} \label{estimation-noisy}
%\chi_i(\tau) = \max\limits_{\hat{\alpha}, \xi_{\tau}, \xi^d} G_{\tau i}\hat{y},
%\end{equation}
%$$\begin{pmatrix}
%U_\tau^p \\
%Y_\tau^p + \mathit{\Xi}_\tau^p\\
%U_\tau^f \\
%Y_\tau^f + \mathit{\Xi}_\tau^f \\
%\end{pmatrix} \hat{\alpha} = \begin{pmatrix}
%u_\tau^p \\
%\tilde{y}_\tau^p + \xi_{\tau}\\
%0 \\
%\hat{y}\\
%\end{pmatrix},
%$$
%$$-\varepsilon \mathbbm{1} \leq \xi_{\tau} \leq \varepsilon \mathbbm{1},$$
%$$-\varepsilon \mathbbm{1} \leq \xi^d \leq \varepsilon \mathbbm{1}.$$
%
%Задача (\ref{estimation-noisy}) представяет собой задачу с квадратичной целевой функцией и квадратичными ограничениями относительно переменной $(\hat{\alpha}, \xi^d)$. Сложность заключается в том, данная задача является невыпуклой. В дальнейшем было бы интересно исследовать эффективные способы решения этой невыпуклой задачи оптимального оценивания. Впоследствии можно использовать этот результат для решения соответствующей задачи оптимального управления в условии неточной априорной траектории.

\bigskip
В данной главе был предложен новый способ решения задачи, поставленной в предыдущей главе. Этот способ не требует знания реализации системы в пространстве состояний. Предложенный метод сводится к решению задач линейного и квадратичного программирования, базирующихся лишь на двух траекториях системы: априорной и наблюдаемой в процессе управления.

Доказано, что если в начальный момент управления эти задачи линейного и квадратичного программирования разрешимы, то соответсвующие задачи разрешимы и в каждый последующий момент, при этом значение критерия качества гарантированно не возрастает. 

Задача решена в предположении, что траектория, измеряемая в процессе управления, неточна, но априорная траектория известна точно.% Было предложено дальнейшее направление исследования: случай, когда априорная траектория также зашумлена. 