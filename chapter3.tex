\chapter{ПОСТАНОВКА ЗАДАЧИ В ОТСУТСТВИЕ МОДЕЛИ СИСТЕМЫ}\label{chap3}
Ниже будет рассмотрена задача из предыдущей главы в условии отсутствия заранее известной реализации системы в пространстве состояний. Классический подход в подобных ситуациях состоит в предварительной идентификации системы
и последующем решении задачи уже имеющимся способом, основанным на знании модели. Однако, такой подход не всегда целесообразен.

В этой главе будет предложен альтернативный способ, не нуждающийся в явном параметрическом представлении системы вовсе. Основой ему послужит бихевиористский подход к динамическим системам, изложенный в главе \ref{chap1}, а также принцип разделимости управления и наблюдения, уже использовавшийся в главе \ref{chap2}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Постановка и решение задачи по сгенерированным данным}\label{data-driven-approach} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Будем считать, что наши сведения о линейной системе $G$ сводятся к верхней оценке ее размерности $n$ и одной предварительно сгенерированной траектории $\{u^d(t), y^d(t)\}_{t = 0}^{T^d - 1}$, причем эта траектория измерена точно. Что до траекторий "прошлого"\ ${\{(u^p(0), u^p(1), \ldots, u^p(\tau-1)), (y^p(0), y^p(1), \ldots, y^p(\tau-1))\} = \{u_\tau^p, y_\tau^p \}}$, известных к текущему моменту $\tau$ в процессе управления системой, их будем считать измеренными с точностью до ограниченной ошибки: нам доступны лишь $\{u_\tau^p, \tilde{y}_\tau^p\}$, где ${\tilde{y}^p_\tau = y^p_\tau + \xi_\tau}$.

Задачей в текущий момент времени $\tau$, подобно предыдущей главе, ставится минимизация квадратичного критерия качества 
$$\sum_{t = \tau}^{T-1} \norm{u(t)}^2,$$ 
при гарантированном соблюдении линейных условий 
$$G(t)y(t) \leq g(t), \quad u_{\min} \leq u(t) \leq u_{\max}, \quad \tau \leq t \leq T-1,$$
на входные и выходные сигналы.


\bigskip
Продемонстрируем, как априорная траектория $\{u^d, y^d\}$ при определенных условиях может иметь ту же информационную ценность, что и модель системы, в случае ее наличия.

Теорема \ref{trajectory check} в непосредственно приведенной формулировке позволяет проверять любую траекторию фиксированной длины на принадлежность системе. В нашем случае стоит обратная задача: дабы определить, допустимо ли конкретное управление в конкретный момент времени, хотелось бы уметь в некотором смысле симулировать систему.

Модификацию Теоремы \ref{trajectory check} можно использовать для генерации множества возможных траекторий $\{u^p_\tau, u, y^p_\tau, y\}$ длины $T$ с некоторой фиксированной "прошлой"\ начальной частью $\{u^p_\tau, y^p_\tau\}$ длины $\tau$. К нефиксированной части ${\{u, y\} = \{u(\tau), \ldots, u(T-1), y(\tau), \ldots, y(T-1)\}}$ будем обращаться как к "будущей"\ части траектории. 
Соответствующим образом будем делить на "прошлое"\ и "будущее"\ для момента $\tau$ и строки матриц Ганкеля для априорной траектории:
\begin{equation}
H_T(u^d) = \begin{pmatrix}
  u^d(0) & \cdots & u^d(T^d-T)\\
  \vdots & \ddots & \vdots \\
  u^d(\tau-1) & \cdots & u^d(\tau-1 + T^d - T) \\
  \hline
  u^d(\tau) & \cdots & u^d(\tau + T^d-T)\\
  \vdots & \ddots & \vdots \\
  u^d(T-1) & \cdots & u^d(T^d-1)
\end{pmatrix} = 
		\begin{pmatrix}
		U_{\tau}^p \\
		U_{\tau}^f
		\end{pmatrix},  
\end{equation}
\begin{equation}
H_T(y^d) = \begin{pmatrix}
  y^d(0) & \cdots & y^d(T^d-T)\\
  \vdots & \ddots & \vdots \\
  y^d(\tau-1) & \cdots & y^d(\tau-1 + T^d - T) \\
  \hline
  y^d(\tau) & \cdots & y^d(\tau + T^d-T)\\
  \vdots & \ddots & \vdots \\
  y^d(T-1) & \cdots & y^d(T^d-1)
\end{pmatrix} = 
		\begin{pmatrix}
		Y_{\tau}^p \\
		Y_{\tau}^f
		\end{pmatrix},  
\end{equation}

Если входной сигнал $u^d$ является постоянно возбуждающим порядка ${n + T}$, то, согласно Теореме \ref{trajectory check}, $\{u_{\tau}^p, u, y_{\tau}^p, y\}$ является траекторией системы $G$ тогда и только тогда, когда у уравнения 
\begin{equation}\label{traj-cond}
\begin{pmatrix}
U_{\tau}^p \\
Y_{\tau}^p \\
U_{\tau}^f \\
Y_{\tau}^f
\end{pmatrix} \alpha = \begin{pmatrix}
u_{\tau}^p \\
y_{\tau}^p \\
u \\
y
\end{pmatrix}
\end{equation}
есть решение $\alpha \in \mathbb{R}^{T^d - T +1}$.
Потомy для построения возможных траекторий можно воспользоваться следующим алгоритмом.\\
1. Зафиксировать интересующее значение "будущего"\ входного сигнала $u$.\\
2. Для выбранного $u$ найти некоторое решение $\alpha \in \mathbb{R}^{T^d-T+1}$ системы линейных алгебраических уравнений
\begin{equation}
\begin{pmatrix}
U_{\tau}^p \\
Y_{\tau}^p \\
U_{\tau}^f 
\end{pmatrix} \alpha = \begin{pmatrix}
u_{\tau}^p \\
y_{\tau}^p \\
u
\end{pmatrix}.
\end{equation}
3. Вычислить $y = Y_{\tau}^f \alpha$. Получили одну из возможных траекторий для фиксированных $u^p_\tau, y^p_\tau, u$.

\begin{remark}
В силу Теоремы \ref{trajectory check}, для любых $u^p_\tau, y^p_\tau, u$ хотя бы одну возможную выходную траекторию $y$ мы найти сможем, а вот для единственности $y$, которая представляет особый практический интерес, нужно наложить некоторые условия. Поскольку для линейной системы размерности $n$ траектория длины $n$ однозначно определяет начальное состояние, то для обеспечения единственности достаточно потребовать $\tau \geq n$. Потому в дальнейшем полагаем, что управление начинается в момент $n$, --- это своего рода неявный аналог явного ограничения $x_0 \in X_0$ в постановке задачи при известной модели.
\end{remark}

\begin{remark}\label{lower bound on T^d}
Чем больше горизонт планирования $T$, тем больше и длина априорной траектории $T^d$. Поскольку нам необходим постоянно возбуждающий порядка $n + T$ сигнал $u^d$, то,  как уже отмечалось в Замечании \ref{remark on input length}, для длины $T^d$ этого сигнала справедлива оценка $T^d \geq (n + T)(m + 1) - 1,$ где $m$ --- размерность входа. 
\end{remark} 

Вместо явного задания динамики системы моделью в пространстве состояний, будем пользоваться неявным описанием вида (\ref{traj-cond}) поведения системы. Начальное состояние системы также фиксируем неявно, начиная управление в момент $n$.

\bigskip
Таким образом, в каждый момент времени $n \leq \tau \leq T$ решаем следующую задачу оптимального программного управления, обладая неточной траекторией $\{u_\tau^p, \tilde{y}_\tau^p\}$:
\begin{equation}\label{dd-oc-at-tau}
\min\limits_u u^Tu, 
\end{equation}
$$
\begin{pmatrix}
U_\tau^p \\
Y_\tau^p \\
U_\tau^f \\
\end{pmatrix} \alpha = \begin{pmatrix}
u_\tau^p \\
y_\tau^p \\
u \\
\end{pmatrix},
$$
$$
\tilde{y}_\tau^p = y_\tau^p + \xi_\tau, \quad -\varepsilon\mathbbm{1} \leq \xi_\tau \leq \varepsilon \mathbbm{1},
$$
$$u_{\min}(\tau) \leq u \leq u_{\max}(\tau),$$
$$
G_\tau Y_\tau^f \alpha \leq g_\tau \quad \forall \alpha, \xi_\tau,
$$
где матрица 
\[
G_\tau = 
\begin{pmatrix}
  \begin{matrix}
  G(\tau)
  \end{matrix}
  & \rvline & \bigzero & \rvline & \cdots & \rvline & \bigzero\\
\hline
  \bigzero & \rvline &
  \begin{matrix}
    G(\tau + 1)
  \end{matrix}
  & \rvline & \cdots  & \rvline & \bigzero \\
\hline
  \vdots & \rvline & \vdots & \rvline & 
  \begin{matrix}
    \ddots
  \end{matrix} 
  & \rvline & \bigzero \\
\hline
  \bigzero & \rvline & \bigzero & \rvline & \bigzero & \rvline &
  \begin{matrix}
    G(T-1)
  \end{matrix}
\end{pmatrix},
\]
вектор $g_{\tau} = (g(\tau), g(\tau+1), \cdots, g(T-1)),$ \\
$u_{\min}(\tau) = (\underbrace{u_{\min}, \ldots, u_{\min}}_{T - \tau \textup{ раз}}), \quad u_{\max}(\tau) = (\underbrace{u_{\max}, \ldots, u_{\max}}_{T - \tau \textup{ раз}}).$ 

Из полученного в момент $\tau$ оптимального управляющего воздействия $u^*(\tau, u^p_\tau, \tilde{y}^p_\tau) = (u^*(\tau|\tau, u^p_\tau, \tilde{y}^p_\tau), u^*(\tau+1|\tau, u^p_\tau, \tilde{y}^p_\tau), \ldots, u^*(T-1|\tau, u^p_\tau, \tilde{y}^p_\tau))$ мы применяем к системе $u^p(\tau) = u^*(\tau|\tau, u^p_\tau, \tilde{y}^p_\tau).$ Переходим к решению задачи (\ref{dd-oc-at-tau}) в момент $\tau+1$, зная траекторию $\{u^p_{\tau+1}, \tilde{y}^p_{\tau+1}\}$. Таким образом, если существовало допустимое воздействие в момент $\tau$, то гарантировано существует допустимое воздействие в момент $\tau + 1$, причем значение критерия качества на каждом шагу не увеличивается.

\bigskip
Многообещающим выглядит разделение наблюдения и управления, использованное в предыдущем разделе. Продемонстрируем, как элегантно реализуется принцип разделимости в бихевиористской манере.
\begin{lemma}\label{dd-separation}
Пусть $\{u_{\tau}^p, y_{\tau}^p \}$ --- некоторая фиксированная траектория системы (\ref{traj-cond}) длины $\tau \geq n$. Тогда любая траектория $\{u_{\tau}^p, u, y_{\tau}^p, y\}$ длины $T$ системы (\ref{traj-cond}) однозначно представима в виде суммы траекторий $\{0, u, 0, y_0\}$ и $\{u_{\tau}^p, 0, y_{\tau}^p, \hat{y}\}$ длины $T$, причем для фиксированного $u$ определить неизвестные участки $y_0, \hat{y}$ можно следующим образом:\\
1. Найти некоторые решения $\hat{\alpha}, \alpha_0$ алгебраичеких уравнений
\begin{equation}
\begin{pmatrix}                     
U_\tau^p \\                         
Y_\tau^p \\
U_\tau^f \\
\end{pmatrix} \hat{\alpha} = \begin{pmatrix}
u_\tau^p \\
y_\tau^p \\
0 \\
\end{pmatrix}, \quad
\begin{pmatrix}
U_\tau^p \\
Y_\tau^p \\
U_\tau^f \\
\end{pmatrix} \alpha_0 = \begin{pmatrix}
0 \\
0 \\
u \\
\end{pmatrix}.
\end{equation}
2. Вычислить $\hat{y} = Y_\tau^f\hat{\alpha}, \quad y_0 = Y_\tau^f\alpha_0.$
\end{lemma}

\begin{proof}
Поскольку длина $\tau$ исходной траектории не меньше размерности системы $n$, то, в силу модификации Теоремы \ref{trajectory check}, однозначно определены и могут быть найдены в результате 1-2 выходы системы $\hat{y}, y_0$ для входных сигналов $0, u$ соответственно. Более того, $\hat{y}$ соответствует выходной траектории неуправляемой с момента $\tau$ системы, а $y_0$ --- номинальной выходной траектории из нулевого состояния в момент $\tau$ (нулевое состояние в момент $\tau$  неявно задают $\{u_\tau^p, y_\tau^p\} = \{0, 0\}$ --- именно такую траекторию имеет система с нулевым начальным состоянием, а значит, и с нулевым состоянием в момент $ \tau$; с другой стороны, $\tau \geq n$ обеспечивает единственность этой траектории). 
\QEDB
\end{proof}

\bigskip
В связи с вышеизложенным, ограничение на выходные сигналы принимает вид
$G_{\tau}(y_0+\hat{y}) \leq g_{\tau}$. Наложим на $y_0$ суженное условие: 
\begin{equation}\label{tightened constraint}
G_{\tau}y_0 \leq g_{\tau}-\chi(\tau),
\end{equation}
где каждая компонента $\chi_i(\tau)$ соответствует наихудшей реализации состояния системы в момент $\tau$, а именно является решением задачи (\ref{estimation}) линейного программирования.
\begin{equation} \label{estimation}
\chi_i(\tau) = \max\limits_{\hat{\alpha}, \xi_{\tau}, \hat{y}} G_{\tau i}\hat{y},
\end{equation}
$$\begin{pmatrix}
U_\tau^p \\
Y_\tau^p \\
U_\tau^f \\
Y_\tau^f \\
\end{pmatrix} \hat{\alpha} = \begin{pmatrix}
u_\tau^p \\
\tilde{y}_\tau^p + \xi_{\tau}\\
0 \\
\hat{y}\\
\end{pmatrix},
$$
$$-\varepsilon \mathbbm{1} \leq \xi_{\tau} \leq \varepsilon \mathbbm{1}.$$
Что, в более компактной формулировке, представляет собой задачу
\begin{equation} \label{estimation-lp}
\chi_i(\tau) = \max\limits_{\hat{\alpha}} G_{\tau i}Y_{\tau}^f\hat{\alpha},
\end{equation}
$$\begin{pmatrix}
U_\tau^p \\
U_\tau^f \\
\end{pmatrix} \hat{\alpha} = \begin{pmatrix}
u_\tau^p \\
0 \\
\end{pmatrix},
$$
$$
\tilde{y}_{\tau}^p-\varepsilon \mathbbm{1} \leq 
Y_\tau^p \hat{\alpha} \leq 
\tilde{y}_\tau^p + \varepsilon \mathbbm{1}.
$$
Удовлетворение $y_0$ суженного ограничения (\ref{tightened constraint}) автоматически влечет удовлетворение исходного ограничения на $y$ для любой возможной реализации $\hat{y}$.
\bigskip




\begin{comment}
\begin{definition}
\textit{Уровнем ошибки} в задаче \ref{estimation-lp} будем называть $\varepsilon$, а \textit{номинальной задачей наблюдения при уровне ошибки} $\varepsilon$ будем называть задачу \ref{estimation-lp} для истинной траектории, т.е. для случая $\tilde{y}_\tau = y_\tau.$
\end{definition}
Очевидно, если задача \ref{estimation-lp} разрешима при любой покомпонентно ограниченной $\varepsilon$ ошибке, то должна быть разрешима номинальная задача. Еще один результат, касающийся вопроса гарантированной разрешимости приведем ниже.
\begin{lemma}\label{estimation-guarantees}
Если номинальная задача наблюдения при уровне ошибки $\varepsilon$ разрешима, то для любого неточного выходного сигнала $\tilde{y}_\tau = y_\tau + \xi_\tau$, где ошибка ограничена поэлементно $\norm{\xi_\tau}_\infty \leq \frac{\varepsilon}{2}$ соответствующая задача\ref{estimation-lp} также имеет решение.
\end{lemma}
\begin{proof}
Для любого $\tilde{y}_\tau = y_\tau + \xi_\tau$ с ограниченной ошибкой $\norm{\xi_\tau}_\infty \leq \frac{\varepsilon}{2}$ задача \ref{estimation-lp} имеет те же самые целевую функцию и ограничения в виде равенств, а также не менее сильные ограничивающие неравенства: 
$$y_\tau - \varepsilon \mathbbm{1} \leq \tilde{y}_\tau - \frac{\varepsilon}{2}\mathbbm{1} \leq Y_\tau^p\hat{\alpha} \leq \tilde{y}_\tau + \frac{\varepsilon}{2}\mathbbm{1} \leq y_\tau + \varepsilon \mathbbm{1}.$$
\end{proof}
\end{comment}





Детерминированная задача оптимального программного управления с суженными условиями на $y_0$ принимает следующий вид:

\begin{equation}\label{control}
\min\limits_{\alpha_0, u, y_0}u^Tu,
\end{equation} 
$$\begin{pmatrix}
U_\tau^p \\
Y_\tau^p \\
U_\tau^f \\
Y_\tau^f \\
\end{pmatrix} \alpha_0 = \begin{pmatrix}
0 \\
0 \\
u \\
y_0 \\
\end{pmatrix},$$
$$G_{\tau}y_0 \leq g_{\tau} - \chi(\tau),$$
$$u_{\min}(\tau) \leq u \leq u_{\max}(\tau).$$

Снова переходим к эквивалентному, но более компактному виду, получаем
\begin{equation}\label{control-qp}
\min\limits_{\alpha_0}\alpha_0^T{U_{\tau}^f}^TU_{\tau}^f\alpha_0,
\end{equation} 
$$
\begin{pmatrix}
U_\tau^p \\
Y_\tau^p \\
\end{pmatrix} \alpha_0 = \begin{pmatrix}
0 \\
0 \\
\end{pmatrix},
$$
$$G_{\tau}Y_{\tau}^f\alpha_0 \leq g_{\tau} - \chi(\tau),$$
$$u_{\min}(\tau) \leq U_{\tau}^f\alpha_0 \leq u_{\max}(\tau).$$
Получив решение $\alpha_0^*(\tau, u_\tau^p, \tilde{y}_\tau^p)$ задачи  (\ref{control-qp}), вычисляем оптимальное управление ${u^*(\tau, u_\tau^p, \tilde{y}_\tau^p) = U_\tau^f \alpha_0^*(\tau, u_\tau^p, \tilde{y}_\tau^p)}$. Из вычисленного ${u^*(\tau, u_\tau^p, \tilde{y}_\tau^p) = (u^*(\tau|\tau, u_\tau^p, \tilde{y}_\tau^p), \ldots, u^*(T-1|\tau, u_\tau^p, \tilde{y}_\tau^p))}$ подаем на вход системе ${u^p(\tau) = u^*(\tau|\tau, u_\tau^p, \tilde{y}_\tau^p).}$ 

\bigskip
Таким образом, задача оптимального управления, решаемая в каждой временной точке $n \leq \tau \leq T-1$, свелась к нескольким задачам линейного программирования и одной выпуклой задаче квадратичного программирования.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Недетерминированный случай: априорные измерения неточны}
В этом разделе будет кратко приведена идея развития результатов.
Интерес представляет случай, когда и априорные измерения содержат некоторую ошибку, т.е. $\tilde{y}^d = y^d + \xi^d.$

Тогда $\tilde{Y}_{\tau}^p = Y_{\tau}^p + \mathit{\Xi}_{\tau}^p$,
$\tilde{Y}_{\tau}^f = Y_{\tau}^f + \mathit{\Xi}_{\tau}^f$, где 
$$
\begin{pmatrix}
		\mathit{\Xi}_{\tau}^p\\
		\mathit{\Xi}_{\tau}^f
		\end{pmatrix}  = \begin{pmatrix}
  \xi(0) & \cdots & \xi(T^d-T)\\
  \vdots & \ddots & \vdots \\
  \xi(\tau-1) & \cdots & \xi(\tau - 1 + T^d-T) \\
  \hline
  \xi(\tau) & \cdots & \xi(\tau + T^d-T)\\
  \vdots & \ddots & \vdots \\
  \xi(T-1) & \cdots & \xi(T^d-1)
\end{pmatrix} 
    = H_T(\xi^d). 
$$

В соответствии с этим задача оптимального оценивания (\ref{estimation}) перепишется следующим образом:

\begin{equation} \label{estimation-noisy}
\chi_i(\tau) = \max\limits_{\hat{\alpha}, \xi_{\tau}, \xi^d} G_{\tau i}\hat{y},
\end{equation}
$$\begin{pmatrix}
U_\tau^p \\
Y_\tau^p + \mathit{\Xi}_\tau^p\\
U_\tau^f \\
Y_\tau^f + \mathit{\Xi}_\tau^f \\
\end{pmatrix} \hat{\alpha} = \begin{pmatrix}
u_\tau^p \\
\tilde{y}_\tau^p + \xi_{\tau}\\
0 \\
\hat{y}\\
\end{pmatrix},
$$
$$-\varepsilon \mathbbm{1} \leq \xi_{\tau} \leq \varepsilon \mathbbm{1},$$
$$-\varepsilon \mathbbm{1} \leq \xi^d \leq \varepsilon \mathbbm{1}.$$

Задача (\ref{estimation-noisy}) представяет собой задачу с квадратичной целевой функцией и квадратичными ограничениями относительно переменной $(\hat{\alpha}, \xi^d)$. Сложность заключается в том, данная задача является невыпуклой. В дальнейшем было бы интересно исследовать эффективные способы решения этой невыпуклой задачи оптимального оценивания. Впоследствии можно использовать этот результат для решения соответствующей задачи оптимального управления в условии неточной априорной траектории. 

\newpage
В данной главе был предложен новый способ решения задачи, поставленной в предыдущей главе. Этот способ не требует знания реализации системы в пространстве состояний. Предложенный метод сводится к решению задач линейного и квадратичного программирования, базирующихся лишь на двух траекториях системы: априорной и наблюдаемой в процессе управления.

Задача решена в предположении, что траектория, измеряемая в процессе управления, неточна, но априорная траектория известна точно. Было предложено дальнейшее направление исследования: случай, когда априорная траектория также зашумлена.